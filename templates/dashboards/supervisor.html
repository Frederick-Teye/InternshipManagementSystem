{% extends "dashboards/base.html" %}

{% block nav_items %}
  <li class="nav-item">
    <a class="nav-link" href="{% url 'interns:list' %}"><i class="fas fa-users"></i> All Interns</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'attendance:pending_approvals' %}"><i class="fas fa-clock"></i> Pending Approvals</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'evaluations:assessment_list' %}"><i class="fas fa-star"></i> Assessments</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'attendance:list' %}"><i class="fas fa-calendar-check"></i> Attendance</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'absenteeism:pending_requests' %}"><i class="fas fa-calendar-times"></i> Absences</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'interns:list' %}"><i class="fas fa-users"></i> My Interns</a>
  </li>
{% endblock %}

{% block dashboard_content %}
<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="mb-1">Supervisor Dashboard ğŸ‘¨â€ğŸ’¼</h1>
        <p class="text-muted mb-0">Manage and monitor intern performance</p>
      </div>
      <div class="text-end d-none d-md-block">
        <div class="text-muted small">Today</div>
        <div class="fw-bold">{{ today|date:"M j, Y" }}</div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Quick Actions -->
  <div class="col-lg-8 mb-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0"><i class="fas fa-bolt text-warning"></i> Quick Actions</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <a href="{% url 'attendance:pending_approvals' %}" class="quick-action-btn">
              <i class="fas fa-user-check text-primary"></i>
              <span>Approve Attendance</span>
            </a>
          </div>
          <div class="col-md-6">
            <a href="{% url 'evaluations:assessment_list' %}?status=submitted" class="quick-action-btn">
              <i class="fas fa-clipboard-check text-success"></i>
              <span>Review Assessments</span>
            </a>
          </div>
          <div class="col-md-6">
            <a href="{% url 'evaluations:assessment_list' %}" class="quick-action-btn">
              <i class="fas fa-plus-circle text-info"></i>
              <span>Create Assessment</span>
            </a>
          </div>
          <div class="col-md-6">
            <a href="{% url 'attendance:list' %}" class="quick-action-btn">
              <i class="fas fa-chart-line text-warning"></i>
              <span>View Reports</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="col-lg-4 mb-4">
    <div class="card text-center mb-3">
      <div class="card-body">
        <i class="fas fa-users fa-2x text-primary mb-2"></i>
        <h3 class="mb-0">{{ intern_count|default:0 }}</h3>
        <p class="text-muted mb-0">My Interns</p>
      </div>
    </div>

    <div class="card text-center mb-3">
      <div class="card-body">
        <i class="fas fa-clock fa-2x text-warning mb-2"></i>
        <h3 class="mb-0">{{ pending_attendance|default:0 }}</h3>
        <p class="text-muted mb-0">Pending Attendance</p>
      </div>
    </div>

    <div class="card text-center">
      <div class="card-body">
        <i class="fas fa-clipboard-list fa-2x text-info mb-2"></i>
        <h3 class="mb-0">{{ pending_assessments|default:0 }}</h3>
        <p class="text-muted mb-0">Pending Assessments</p>
      </div>
    </div>
  </div>
</div>

<!-- Pending Items -->
<div class="row">
  <!-- Pending Attendance -->
  {% if recent_attendance %}
  <div class="col-md-4 mb-4">
    <div class="card">
      <div class="card-header bg-warning text-dark">
        <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Pending Attendance ({{ pending_attendance }})</h6>
      </div>
      <div class="card-body">
        <div class="list-group list-group-flush">
          {% for att in recent_attendance %}
          <a href="{% url 'attendance:approve' att.id %}" class="list-group-item list-group-item-action">
            <strong>{{ att.intern.user.get_full_name }}</strong>
            <br>
            <small class="text-muted">{{ att.check_in_time|date:"M d, g:i A" }}</small>
          </a>
          {% endfor %}
        </div>
        <div class="mt-3 text-center">
          <a href="{% url 'attendance:pending_approvals' %}" class="btn btn-sm btn-warning">View All</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  
  <!-- Pending Assessments -->
  {% if recent_assessments %}
  <div class="col-md-4 mb-4">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h6 class="mb-0"><i class="fas fa-clipboard-check me-2"></i>Pending Assessments ({{ pending_assessments }})</h6>
      </div>
      <div class="card-body">
        <div class="list-group list-group-flush">
          {% for assessment in recent_assessments %}
          <a href="{% url 'evaluations:assess_intern' assessment.id %}" class="list-group-item list-group-item-action">
            <strong>{{ assessment.intern.user.get_full_name }}</strong>
            <br>
            <small class="text-muted">Week {{ assessment.week_number }}</small>
          </a>
          {% endfor %}
        </div>
        <div class="mt-3 text-center">
          <a href="{% url 'evaluations:assessment_list' %}?status=submitted" class="btn btn-sm btn-info">View All</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  
  <!-- Pending Absences -->
  {% if recent_absences %}
  <div class="col-md-4 mb-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h6 class="mb-0"><i class="fas fa-calendar-times me-2"></i>Pending Absences ({{ pending_absences }})</h6>
      </div>
      <div class="card-body">
        <div class="list-group list-group-flush">
          {% for request in recent_absences %}
          <a href="{% url 'absenteeism:approve' request.id %}" class="list-group-item list-group-item-action">
            <strong>{{ request.intern.user.get_full_name }}</strong>
            <br>
            <small class="text-muted">{{ request.start_date|date:"M d" }} - {{ request.end_date|date:"M d" }}</small>
          </a>
          {% endfor %}
        </div>
        <div class="mt-3 text-center">
          <a href="{% url 'absenteeism:pending_requests' %}" class="btn btn-sm btn-primary">View All</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<!-- My Interns -->
{% if my_interns %}
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0"><i class="fas fa-users"></i> My Interns</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>School</th>
                <th>Branch</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for intern in my_interns %}
              <tr>
                <td><strong>{{ intern.user.get_full_name }}</strong></td>
                <td><small class="text-muted">{{ intern.user.email }}</small></td>
                <td>{{ intern.school.name|default:"N/A" }}</td>
                <td>{{ intern.branch.name|default:"N/A" }}</td>
                <td>
                  <a href="{% url 'evaluations:create_assessment' intern.id %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-star me-1"></i>Assess
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
